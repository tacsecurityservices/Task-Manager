<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- jsPDF-AutoTable plugin for table generation in PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='50%' y='50%' font-family='Arial, sans-serif' font-size='60' font-weight='bold' text-anchor='end' dominant-baseline='middle' fill='%233B82F6'>T</text><circle cx='80' cy='50' r='10' fill='%233B82F6'/></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .notification.show {
            transform: translateX(0);
        }
        .notification.success {
            background-color: #10B981;
        }
        .notification.error {
            background-color: #EF4444;
        }
        .notification.info {
            background-color: #3B82F6;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            flex-direction: column;
        }
        .loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3B82F6;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Custom styles for mobile responsiveness */
        @media (max-width: 767px) {
            .header-content {
                flex-direction: column;
                align-items: center;
                gap: 1rem;
            }
            .header-content h1 {
                font-size: 1.5rem; /* Smaller font for mobile header */
            }
            .header-content button {
                width: 100%; /* Full width button on mobile */
            }
            .main-content-area {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            .task-form-grid, .order-form-grid {
                grid-template-columns: 1fr; /* Stack form fields on mobile */
            }
            .task-list-item, .order-list-item {
                flex-direction: column; /* Stack task details and buttons */
                align-items: flex-start;
            }
            .task-list-item .flex-grow, .order-list-item .flex-grow {
                margin-bottom: 0.5rem; /* Space between details and buttons */
            }
            .task-list-item .flex-wrap, .order-list-item .flex-wrap {
                width: 100%; /* Buttons take full width */
                justify-content: center; /* Center buttons */
            }
            .task-filters, .order-filters {
                justify-content: center; /* Center filter buttons */
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50 text-gray-800 min-h-screen">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loader"></div>
        <p class="text-gray-700 font-semibold text-lg">Loading data...</p>
    </div>

    <!-- Notification Container -->
    <div id="notification" class="notification"></div>

    <!-- Main App Content -->
    <div id="appContent" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-lg py-4 border-b border-gray-200">
            <div class="container mx-auto px-4 flex justify-between items-center header-content">
                <div class="flex items-center space-x-3">
                    <h1 class="text-xl sm:text-2xl font-bold text-gray-800">Business Manager</h1>
                </div>
                <!-- Updated Export Button -->
                <button id="exportBtn" class="px-4 py-2 rounded-lg bg-purple-500 text-white font-semibold hover:bg-purple-600 transition-colors shadow-md">
                    ðŸ“„ Download
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-grow container mx-auto px-4 py-8 main-content-area space-y-8">
            <!-- Auto-save Status -->
            <div class="flex justify-end items-center mb-6">
                <span id="autoSaveStatus" class="text-sm text-green-600 font-medium">âœ“ Auto-save enabled</span>
            </div>

            <!-- Tasks Section -->
            <section id="tasks-section" class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 text-center">âœ“ Task Management</h2>
                <p class="text-gray-600 mb-6 text-center text-sm sm:text-base">Keep track of your business tasks. Add new tasks, mark them as complete, or edit details.</p>

                <div class="p-6 border border-gray-200 rounded-xl bg-gradient-to-br from-gray-50 to-white shadow-sm mb-8">
                    <h3 class="text-lg sm:text-xl font-semibold text-gray-700 mb-4 flex items-center">
                        <span class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center text-white text-sm mr-2">+</span>
                        Add New Task
                    </h3>
                    <form id="taskForm" class="space-y-4">
                        <div>
                            <label for="taskDescription" class="block text-sm font-medium text-gray-700 mb-1">Task Description</label>
                            <textarea id="taskDescription" rows="3" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="Enter task description..." required></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 task-form-grid">
                            <div>
                                <label for="taskDueDate" class="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
                                <input type="date" id="taskDueDate" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            </div>
                            <div>
                                <label for="taskPriority" class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                                <select id="taskPriority" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                    <option value="Low">Low</option>
                                    <option value="Medium">Medium</option>
                                    <option value="High">High</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="w-full px-4 py-3 rounded-lg bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold hover:from-green-600 hover:to-green-700 transition-all duration-200 shadow-md">
                            Add Task
                        </button>
                    </form>
                </div>

                <!-- Task Filters -->
                <div class="flex flex-wrap gap-2 mb-6 task-filters">
                    <button id="filterAllTasks" class="px-4 py-2 rounded-lg bg-blue-500 text-white font-semibold hover:bg-blue-600 transition-colors text-sm">All</button>
                    <button id="filterPendingTasks" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300 transition-colors text-sm">Pending</button>
                    <button id="filterCompletedTasks" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300 transition-colors text-sm">Completed</button>
                    <button id="filterHighTasks" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300 transition-colors text-sm">High Priority</button>
                </div>

                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Current Tasks</h3>
                    <div id="taskList" class="space-y-4">
                        <!-- Tasks will be rendered here -->
                    </div>
                    <p id="noTasksMessage" class="text-center text-gray-500 mt-8 hidden">
                        <span class="text-4xl">ðŸ“‹</span><br>
                        No tasks found.<br>
                        <span class="text-sm">Add your first task using the form above.</span>
                    </p>
                </div>
            </section>
            
            <!-- Order Section -->
            <section id="orders-section" class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 mt-8">
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 text-center">ðŸ“¦ Imports</h2>
                <p class="text-gray-600 mb-6 text-center text-sm sm:text-base">Track your international and local imports. Add, edit, and update the status of your orders.</p>

                <div class="p-6 border border-gray-200 rounded-xl bg-gradient-to-br from-gray-50 to-white shadow-sm mb-8">
                    <h3 class="text-lg sm:text-xl font-semibold text-gray-700 mb-4 flex items-center">
                        <span class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-content-center text-white text-sm mr-2">+</span>
                        Add New Order
                    </h3>
                    <form id="orderForm" class="space-y-4">
                        <div>
                            <label for="orderDescription" class="block text-sm font-medium text-gray-700 mb-1">Order Description</label>
                            <textarea id="orderDescription" rows="3" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="Enter order description..." required></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 order-form-grid">
                            <div>
                                <label for="orderCustomer" class="block text-sm font-medium text-gray-700 mb-1">Company</label>
                                <input type="text" id="orderCustomer" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="Customer Name" required>
                            </div>
                            <!-- New input for order origin -->
                            <div>
                                <label for="orderOrigin" class="block text-sm font-medium text-gray-700 mb-1">Order Origin</label>
                                <input type="text" id="orderOrigin" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="e.g., Shanghai, China" required>
                            </div>
                            <div>
                                <label for="orderType" class="block text-sm font-medium text-gray-700 mb-1">Order Type</label>
                                <select id="orderType" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                    <option value="Local">Local</option>
                                    <option value="International">International</option>
                                </select>
                            </div>
                            <div>
                                <label for="orderStatus" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                <select id="orderStatus" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                    <option value="Pending">Pending</option>
                                    <option value="In Transit">In Transit</option>
                                    <option value="Delivered">Delivered</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="w-full px-4 py-3 rounded-lg bg-gradient-to-r from-blue-500 to-blue-600 text-white font-semibold hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-md">
                            Add Order
                        </button>
                    </form>
                </div>
                
                <!-- Order Filters -->
                <div class="flex flex-wrap gap-2 mb-6 order-filters">
                    <button id="filterAllOrders" class="px-4 py-2 rounded-lg bg-blue-500 text-white font-semibold hover:bg-blue-600 transition-colors text-sm">All</button>
                    <button id="filterPendingOrders" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300 transition-colors text-sm">Pending</button>
                    <button id="filterDeliveredOrders" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300 transition-colors text-sm">Delivered</button>
                    <button id="filterInternationalOrders" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300 transition-colors text-sm">International</button>
                </div>

                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Current Orders</h3>
                    <div id="orderList" class="space-y-4">
                        <!-- Orders will be rendered here -->
                    </div>
                    <p id="noOrdersMessage" class="text-center text-gray-500 mt-8 hidden">
                        <span class="text-4xl">ðŸ“¦</span><br>
                        No orders found.<br>
                        <span class="text-sm">Add your first order using the form above.</span>
                    </p>
                </div>
            </section>
        </main>
    </div>

    <!-- Export Options Modal -->
    <div id="exportModal" class="modal-overlay hidden">
        <div class="modal-content text-center">
            <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4">Download</h3>
            <p class="text-gray-600 mb-6">Choose what you would like to download.</p>
            <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                <button id="downloadTasksBtn" class="px-6 py-3 rounded-lg bg-purple-500 text-white font-semibold hover:bg-purple-600 transition-colors shadow-md">
                    Download Tasks
                </button>
                <button id="downloadOrdersBtn" class="px-6 py-3 rounded-lg bg-indigo-500 text-white font-semibold hover:bg-indigo-600 transition-colors shadow-md">
                    Download Orders
                </button>
            </div>
            <button id="closeExportModalBtn" class="mt-6 px-4 py-2 text-sm text-gray-600 hover:text-gray-900 transition-colors">
                Cancel
            </button>
        </div>
    </div>

    <script>
        // --- Application Data ---
        // Tasks and Orders data are now initialized as empty arrays.
        // Data will be loaded from localStorage on page load.
        let tasks = [];
        let orders = [];
        let currentTaskFilter = 'all';
        let currentOrderFilter = 'all';

        // --- DOM Elements ---
        const loadingOverlay = document.getElementById('loadingOverlay');
        const taskForm = document.getElementById('taskForm');
        const taskList = document.getElementById('taskList');
        const noTasksMessage = document.getElementById('noTasksMessage');
        const exportBtn = document.getElementById('exportBtn');
        const exportModal = document.getElementById('exportModal');
        const downloadTasksBtn = document.getElementById('downloadTasksBtn');
        const downloadOrdersBtn = document.getElementById('downloadOrdersBtn');
        const closeExportModalBtn = document.getElementById('closeExportModalBtn');
        const notification = document.getElementById('notification');
        const autoSaveStatus = document.getElementById('autoSaveStatus');
        
        const orderForm = document.getElementById('orderForm');
        const orderList = document.getElementById('orderList');
        const noOrdersMessage = document.getElementById('noOrdersMessage');

        // Task Filter Buttons
        const filterAllTasks = document.getElementById('filterAllTasks');
        const filterPendingTasks = document.getElementById('filterPendingTasks');
        const filterCompletedTasks = document.getElementById('filterCompletedTasks');
        const filterHighTasks = document.getElementById('filterHighTasks');

        // Order Filter Buttons
        const filterAllOrders = document.getElementById('filterAllOrders');
        const filterPendingOrders = document.getElementById('filterPendingOrders');
        const filterDeliveredOrders = document.getElementById('filterDeliveredOrders');
        const filterInternationalOrders = document.getElementById('filterInternationalOrders');

        // --- Utility Functions ---
        function showNotification(message, type = 'info') {
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function showLoading(message = 'Loading data...') {
            loadingOverlay.querySelector('p').textContent = message;
            loadingOverlay.classList.remove('hidden');
        }

        function hideLoading() {
            loadingOverlay.classList.add('hidden');
        }

        function getPriorityColor(priority) {
            switch (priority) {
                case 'High': return 'bg-red-100 border-red-300 text-red-800';
                case 'Medium': return 'bg-yellow-100 border-yellow-300 text-yellow-800';
                case 'Low': return 'bg-green-100 border-green-300 text-green-800';
                default: return 'bg-gray-100 border-gray-300 text-gray-800';
            }
        }
        
        function getOrderStatusColor(status) {
            switch (status) {
                case 'Pending': return 'bg-yellow-100 border-yellow-300 text-yellow-800';
                case 'In Transit': return 'bg-blue-100 border-blue-300 text-blue-800';
                case 'Delivered': return 'bg-green-100 border-green-300 text-green-800';
                default: return 'bg-gray-100 border-gray-300 text-gray-800';
            }
        }

        /**
         * Saves tasks and orders data to localStorage.
         */
        function saveData() {
            // Check if localStorage is available
            try {
                localStorage.setItem('tasks', JSON.stringify(tasks));
                localStorage.setItem('orders', JSON.stringify(orders));
                autoSaveStatus.textContent = `âœ“ Last saved: ${new Date().toLocaleTimeString()}`;
            } catch (error) {
                showNotification('Could not save data. Local Storage may be full or unavailable.', 'error');
                console.error('Error saving to localStorage:', error);
            }
        }

        /**
         * Loads tasks and orders data from localStorage.
         */
        function loadData() {
            showLoading('Loading business data...');
            setTimeout(() => {
                try {
                    const savedTasks = localStorage.getItem('tasks');
                    const savedOrders = localStorage.getItem('orders');

                    if (savedTasks) {
                        tasks = JSON.parse(savedTasks);
                    }

                    if (savedOrders) {
                        orders = JSON.parse(savedOrders);
                    }

                    renderTasks();
                    renderOrders();
                    showNotification('Business data loaded!', 'success');
                    hideLoading();
                } catch (error) {
                    showNotification('Failed to load data. Data may be corrupted.', 'error');
                    console.error('Error loading from localStorage:', error);
                    // Fallback to empty data on error
                    tasks = [];
                    orders = [];
                    renderTasks();
                    renderOrders();
                    hideLoading();
                }
            }, 800);
        }

        // --- Task Functions ---
        function addTask(event) {
            event.preventDefault();
            const description = document.getElementById('taskDescription').value.trim();
            const dueDate = document.getElementById('taskDueDate').value;
            const priority = document.getElementById('taskPriority').value;

            if (!description) {
                showNotification('Please enter a task description.', 'error');
                return;
            }

            const newTask = {
                id: Date.now().toString(),
                description,
                dueDate,
                priority,
                completed: false,
                createdAt: new Date().toISOString()
            };

            tasks.push(newTask);
            saveData();
            renderTasks();
            taskForm.reset();
            showNotification('Task added successfully!', 'success');
        }

        function toggleTaskStatus(taskId) {
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex > -1) {
                tasks[taskIndex].completed = !tasks[taskIndex].completed;
                saveData();
                renderTasks();
                showNotification('Task status updated!', 'success');
            }
        }

        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            const modalHtml = `
                <div class="modal-overlay" id="editModal">
                    <div class="modal-content p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-6 text-center">Edit Task</h3>
                        <form id="editTaskForm" class="space-y-4">
                            <div>
                                <label for="editTaskDescription" class="block text-sm font-medium text-gray-700 mb-1">Task Description</label>
                                <textarea id="editTaskDescription" rows="3" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" required>${task.description}</textarea>
                            </div>
                            <div>
                                <label for="editTaskDueDate" class="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
                                <input type="date" id="editTaskDueDate" value="${task.dueDate || ''}" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            </div>
                            <div>
                                <label for="editTaskPriority" class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                                <select id="editTaskPriority" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                    <option value="Low" ${task.priority === 'Low' ? 'selected' : ''}>Low</option>
                                    <option value="Medium" ${task.priority === 'Medium' ? 'selected' : ''}>Medium</option>
                                    <option value="High" ${task.priority === 'High' ? 'selected' : ''}>High</option>
                                </select>
                            </div>
                            <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-4 mt-6">
                                <button type="button" id="cancelEditTaskBtn" class="px-6 py-2 rounded-lg bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300 transition-colors">Cancel</button>
                                <button type="submit" class="px-6 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition-colors">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHtml);
            const modal = document.getElementById('editModal');

            document.getElementById('editTaskForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const description = document.getElementById('editTaskDescription').value.trim();
                if (!description) {
                    showNotification('Please enter a task description.', 'error');
                    return;
                }

                const updatedTask = {
                    ...task,
                    description,
                    dueDate: document.getElementById('editTaskDueDate').value,
                    priority: document.getElementById('editTaskPriority').value
                };

                const taskIndex = tasks.findIndex(t => t.id === taskId);
                if (taskIndex > -1) {
                    tasks[taskIndex] = updatedTask;
                    saveData();
                    renderTasks();
                    showNotification('Task updated successfully!', 'success');
                    modal.remove();
                }
            });

            document.getElementById('cancelEditTaskBtn').addEventListener('click', function() {
                modal.remove();
            });

            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function deleteTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            const modalHtml = `
                <div class="modal-overlay" id="deleteModal">
                    <div class="modal-content p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 text-center">Confirm Deletion</h3>
                        <p class="text-gray-600 mb-6 text-center text-sm">Are you sure you want to delete this task?</p>
                        <div class="bg-gray-50 p-4 rounded-lg mb-6">
                            <p class="font-semibold text-gray-800">${task.description}</p>
                        </div>
                        <div class="flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4">
                            <button type="button" id="cancelDeleteTaskBtn" class="px-6 py-2 rounded-lg bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300 transition-colors">Cancel</button>
                            <button type="button" id="confirmDeleteTaskBtn" class="px-6 py-2 rounded-lg bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors">Delete</button>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHtml);
            const modal = document.getElementById('deleteModal');

            document.getElementById('confirmDeleteTaskBtn').addEventListener('click', function() {
                tasks = tasks.filter(t => t.id !== taskId);
                saveData();
                renderTasks();
                showNotification('Task deleted successfully!', 'success');
                modal.remove();
            });

            document.getElementById('cancelDeleteTaskBtn').addEventListener('click', function() {
                modal.remove();
            });

            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function renderTasks() {
            taskList.innerHTML = '';

            if (tasks.length === 0) {
                noTasksMessage.classList.remove('hidden');
            } else {
                noTasksMessage.classList.add('hidden');
            }

            // Apply the filter
            let filteredTasks = tasks;
            if (currentTaskFilter === 'pending') {
                filteredTasks = tasks.filter(task => !task.completed);
            } else if (currentTaskFilter === 'completed') {
                filteredTasks = tasks.filter(task => task.completed);
            } else if (currentTaskFilter === 'high') {
                filteredTasks = tasks.filter(task => task.priority === 'High' && !task.completed);
            }

            if (filteredTasks.length === 0 && tasks.length > 0) {
                taskList.innerHTML = '<p class="text-center text-gray-500 py-8">No tasks match the current filter.</p>';
                return;
            }
            
            filteredTasks.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = `task-list-item bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 fade-in ${task.completed ? 'bg-green-50 border-green-200' : 'hover:bg-gray-100 transition-colors'}`;
                
                const taskStatusClass = task.completed ? 'bg-green-500 hover:bg-green-600' : 'bg-gray-300 hover:bg-gray-400';
                const taskStatusText = task.completed ? 'Completed' : 'Pending';

                taskItem.innerHTML = `
                    <div class="flex-grow">
                        <div class="flex items-center mb-2">
                            <span class="px-2 py-0.5 rounded-full text-xs font-semibold ${getPriorityColor(task.priority)}">${task.priority} Priority</span>
                            ${task.dueDate ? `<span class="px-2 py-0.5 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 ml-2">Due: ${task.dueDate}</span>` : ''}
                        </div>
                        <p class="text-gray-900 font-semibold text-lg break-words">${task.description}</p>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="toggleTaskStatus('${task.id}')" class="px-4 py-2 rounded-lg text-white font-semibold text-sm ${taskStatusClass}">
                            ${task.completed ? 'Un-complete' : 'Complete'}
                        </button>
                        <button onclick="editTask('${task.id}')" class="px-4 py-2 rounded-lg bg-blue-500 text-white font-semibold text-sm hover:bg-blue-600 transition-colors">
                            Edit
                        </button>
                        <button onclick="deleteTask('${task.id}')" class="px-4 py-2 rounded-lg bg-red-500 text-white font-semibold text-sm hover:bg-red-600 transition-colors">
                            Delete
                        </button>
                    </div>
                `;
                taskList.appendChild(taskItem);
            });
        }

        // --- Order Functions ---
        function addOrder(event) {
            event.preventDefault();
            const description = document.getElementById('orderDescription').value.trim();
            const customer = document.getElementById('orderCustomer').value.trim();
            const origin = document.getElementById('orderOrigin').value.trim(); // Get the new origin input
            const type = document.getElementById('orderType').value;
            const status = document.getElementById('orderStatus').value;

            if (!description || !customer || !origin) {
                showNotification('Please fill in all order details.', 'error');
                return;
            }

            const newOrder = {
                id: Date.now().toString(),
                description,
                customer,
                origin, // Add origin to the new order object
                type,
                status,
                createdAt: new Date().toISOString()
            };

            orders.push(newOrder);
            saveData();
            renderOrders();
            orderForm.reset();
            showNotification('Order added successfully!', 'success');
        }

        function editOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            const modalHtml = `
                <div class="modal-overlay" id="editOrderModal">
                    <div class="modal-content p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-6 text-center">Edit Order</h3>
                        <form id="editOrderForm" class="space-y-4">
                            <div>
                                <label for="editOrderDescription" class="block text-sm font-medium text-gray-700 mb-1">Order Description</label>
                                <textarea id="editOrderDescription" rows="3" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" required>${order.description}</textarea>
                            </div>
                            <div>
                                <label for="editOrderCustomer" class="block text-sm font-medium text-gray-700 mb-1">Company</label>
                                <input type="text" id="editOrderCustomer" value="${order.customer}" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" required>
                            </div>
                            <div>
                                <label for="editOrderOrigin" class="block text-sm font-medium text-gray-700 mb-1">Order Origin</label>
                                <input type="text" id="editOrderOrigin" value="${order.origin}" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" required>
                            </div>
                            <div>
                                <label for="editOrderType" class="block text-sm font-medium text-gray-700 mb-1">Order Type</label>
                                <select id="editOrderType" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                    <option value="Local" ${order.type === 'Local' ? 'selected' : ''}>Local</option>
                                    <option value="International" ${order.type === 'International' ? 'selected' : ''}>International</option>
                                </select>
                            </div>
                            <div>
                                <label for="editOrderStatus" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                <select id="editOrderStatus" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                    <option value="Pending" ${order.status === 'Pending' ? 'selected' : ''}>Pending</option>
                                    <option value="In Transit" ${order.status === 'In Transit' ? 'selected' : ''}>In Transit</option>
                                    <option value="Delivered" ${order.status === 'Delivered' ? 'selected' : ''}>Delivered</option>
                                </select>
                            </div>
                            <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-4 mt-6">
                                <button type="button" id="cancelEditOrderBtn" class="px-6 py-2 rounded-lg bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300 transition-colors">Cancel</button>
                                <button type="submit" class="px-6 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition-colors">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            const modal = document.getElementById('editOrderModal');
            
            document.getElementById('editOrderForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const description = document.getElementById('editOrderDescription').value.trim();
                const customer = document.getElementById('editOrderCustomer').value.trim();
                const origin = document.getElementById('editOrderOrigin').value.trim();
                if (!description || !customer || !origin) {
                    showNotification('Please fill in all order details.', 'error');
                    return;
                }

                const updatedOrder = {
                    ...order,
                    description,
                    customer,
                    origin,
                    type: document.getElementById('editOrderType').value,
                    status: document.getElementById('editOrderStatus').value
                };

                const orderIndex = orders.findIndex(o => o.id === orderId);
                if (orderIndex > -1) {
                    orders[orderIndex] = updatedOrder;
                    saveData();
                    renderOrders();
                    showNotification('Order updated successfully!', 'success');
                    modal.remove();
                }
            });

            document.getElementById('cancelEditOrderBtn').addEventListener('click', function() {
                modal.remove();
            });

            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function deleteOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            const modalHtml = `
                <div class="modal-overlay" id="deleteOrderModal">
                    <div class="modal-content p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 text-center">Confirm Deletion</h3>
                        <p class="text-gray-600 mb-6 text-center text-sm">Are you sure you want to delete this order?</p>
                        <div class="bg-gray-50 p-4 rounded-lg mb-6">
                            <p class="font-semibold text-gray-800">${order.description} (Company: ${order.customer})</p>
                        </div>
                        <div class="flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4">
                            <button type="button" id="cancelDeleteOrderBtn" class="px-6 py-2 rounded-lg bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300 transition-colors">Cancel</button>
                            <button type="button" id="confirmDeleteOrderBtn" class="px-6 py-2 rounded-lg bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors">Delete</button>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHtml);
            const modal = document.getElementById('deleteOrderModal');

            document.getElementById('confirmDeleteOrderBtn').addEventListener('click', function() {
                orders = orders.filter(o => o.id !== orderId);
                saveData();
                renderOrders();
                showNotification('Order deleted successfully!', 'success');
                modal.remove();
            });

            document.getElementById('cancelDeleteOrderBtn').addEventListener('click', function() {
                modal.remove();
            });

            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function renderOrders() {
            orderList.innerHTML = '';
            
            if (orders.length === 0) {
                noOrdersMessage.classList.remove('hidden');
            } else {
                noOrdersMessage.classList.add('hidden');
            }

            // Apply the filter
            let filteredOrders = orders;
            if (currentOrderFilter === 'pending') {
                filteredOrders = orders.filter(order => order.status === 'Pending');
            } else if (currentOrderFilter === 'delivered') {
                filteredOrders = orders.filter(order => order.status === 'Delivered');
            } else if (currentOrderFilter === 'international') {
                filteredOrders = orders.filter(order => order.type === 'International');
            }

            if (filteredOrders.length === 0 && orders.length > 0) {
                orderList.innerHTML = '<p class="text-center text-gray-500 py-8">No orders match the current filter.</p>';
                return;
            }

            filteredOrders.forEach(order => {
                const orderItem = document.createElement('div');
                orderItem.className = `order-list-item bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 fade-in hover:bg-gray-100 transition-colors`;
                
                orderItem.innerHTML = `
                    <div class="flex-grow">
                        <div class="flex items-center mb-2">
                            <span class="px-2 py-0.5 rounded-full text-xs font-semibold ${getOrderStatusColor(order.status)}">${order.status}</span>
                            <span class="px-2 py-0.5 rounded-full text-xs font-semibold bg-gray-200 text-gray-700 ml-2">${order.type}</span>
                        </div>
                        <p class="text-gray-900 font-semibold text-lg break-words">${order.description}</p>
                        <p class="text-sm text-gray-600">Company: ${order.customer} | Origin: ${order.origin}</p>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="editOrder('${order.id}')" class="px-4 py-2 rounded-lg bg-blue-500 text-white font-semibold text-sm hover:bg-blue-600 transition-colors">
                            Edit
                        </button>
                        <button onclick="deleteOrder('${order.id}')" class="px-4 py-2 rounded-lg bg-red-500 text-white font-semibold text-sm hover:bg-red-600 transition-colors">
                            Delete
                        </button>
                    </div>
                `;
                orderList.appendChild(orderItem);
            });
        }

        // --- PDF Generation ---
        function generateTasksPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const header = function(data) {
                doc.setFontSize(18);
                doc.setTextColor(40);
                doc.text('Business Tasks Report', data.settings.margin.left, 20);
                doc.setFontSize(12);
                doc.setTextColor(100);
                doc.text(`Generated on: ${new Date().toLocaleDateString()}`, data.settings.margin.left, 28);
            };

            const taskColumns = [
                { header: 'Task', dataKey: 'task' },
                { header: 'Due Date', dataKey: 'dueDate' },
                { header: 'Priority', dataKey: 'priority' },
                { header: 'Status', dataKey: 'status' }
            ];

            // Use the tasks array directly for data
            const taskRows = tasks.map(t => ({
                task: t.description + '\n\nâ€¢\nâ€¢\nâ€¢', // Add new lines for the bullet points
                dueDate: t.dueDate || 'N/A',
                priority: t.priority,
                status: t.completed ? 'Completed' : 'Pending'
            }));

            doc.autoTable({
                columns: taskColumns,
                body: taskRows,
                startY: 35,
                didDrawPage: header,
                theme: 'striped',
                headStyles: { fillColor: [59, 130, 246] },
                alternateRowStyles: { fillColor: [243, 244, 246] },
                styles: {
                    font: 'Inter',
                    fontSize: 10,
                    cellPadding: 3,
                },
                columnStyles: {
                    task: { cellWidth: 80, overflow: 'linebreak' },
                    dueDate: { cellWidth: 30 },
                    priority: { cellWidth: 20 },
                    status: { cellWidth: 20 }
                }
            });

            doc.save('business-tasks-report.pdf');
        }

        function generateOrdersPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const header = function(data) {
                doc.setFontSize(18);
                doc.setTextColor(40);
                doc.text('Business Orders Report', data.settings.margin.left, 20);
                doc.setFontSize(12);
                doc.setTextColor(100);
                doc.text(`Generated on: ${new Date().toLocaleDateString()}`, data.settings.margin.left, 28);
            };

            const orderColumns = [
                { header: 'Order Description', dataKey: 'description' },
                { header: 'Company', dataKey: 'customer' },
                { header: 'Origin', dataKey: 'origin' },
                { header: 'Type', dataKey: 'type' },
                { header: 'Status', dataKey: 'status' }
            ];
            const orderRows = orders.map(o => ({
                description: o.description,
                customer: o.customer,
                origin: o.origin,
                type: o.type,
                status: o.status
            }));

            doc.autoTable({
                columns: orderColumns,
                body: orderRows,
                startY: 35,
                didDrawPage: header,
                theme: 'striped',
                headStyles: { fillColor: [59, 130, 246] },
                alternateRowStyles: { fillColor: [243, 244, 246] },
                styles: {
                    font: 'Inter',
                    fontSize: 10,
                    cellPadding: 3,
                }
            });

            doc.save('business-orders-report.pdf');
        }


        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
        });

        taskForm.addEventListener('submit', addTask);
        orderForm.addEventListener('submit', addOrder);

        // Export modal functionality
        exportBtn.addEventListener('click', () => {
            exportModal.classList.remove('hidden');
        });
        closeExportModalBtn.addEventListener('click', () => {
            exportModal.classList.add('hidden');
        });
        exportModal.addEventListener('click', (e) => {
            if (e.target === exportModal) {
                exportModal.classList.add('hidden');
            }
        });
        downloadTasksBtn.addEventListener('click', () => {
            generateTasksPDF();
            exportModal.classList.add('hidden');
            showNotification('Tasks PDF downloaded!', 'success');
        });
        downloadOrdersBtn.addEventListener('click', () => {
            generateOrdersPDF();
            exportModal.classList.add('hidden');
            showNotification('Orders PDF downloaded!', 'success');
        });

        // Task filters
        filterAllTasks.addEventListener('click', () => {
            currentTaskFilter = 'all';
            renderTasks();
        });
        filterPendingTasks.addEventListener('click', () => {
            currentTaskFilter = 'pending';
            renderTasks();
        });
        filterCompletedTasks.addEventListener('click', () => {
            currentTaskFilter = 'completed';
            renderTasks();
        });
        filterHighTasks.addEventListener('click', () => {
            currentTaskFilter = 'high';
            renderTasks();
        });

        // Order filters
        filterAllOrders.addEventListener('click', () => {
            currentOrderFilter = 'all';
            renderOrders();
        });
        filterPendingOrders.addEventListener('click', () => {
            currentOrderFilter = 'pending';
            renderOrders();
        });
        filterDeliveredOrders.addEventListener('click', () => {
            currentOrderFilter = 'delivered';
            renderOrders();
        });
        filterInternationalOrders.addEventListener('click', () => {
            currentOrderFilter = 'international';
            renderOrders();
        });

    </script>
</body>
</html>
